## **üöÄ "GI·∫¢I M√É" EXECUTION PLAN: "B·∫¢N ƒê·ªí" TRUY V·∫§N SQL SERVER CHO D√ÇN CODE üöÄ**

Yo c√°c b·∫°n sinh vi√™n IT! H√¥m nay ch√∫ng ta s·∫Ω c√πng nhau "kh√°m ph√°" m·ªôt c√¥ng c·ª• c·ª±c k·ª≥ m·∫°nh m·∫Ω trong SQL Server: Execution
Plan (K·∫ø ho·∫°ch Th·ª±c thi). ƒê√¢y l√† "b·∫£n ƒë·ªì" chi ti·∫øt v·ªÅ c√°ch SQL Server th·ª±c thi c√¢u l·ªánh c·ªßa b·∫°n, gi√∫p b·∫°n t√¨m ra c√°c
ƒëi·ªÉm "ngh·∫Ωn c·ªï chai" v√† t·ªëi ∆∞u h√≥a truy v·∫•n. C√πng m√¨nh "m·ªï x·∫ª" n√≥ nh√©!

### **I. EXECUTION PLAN L√Ä G√å? (NH∆Ø "B·∫¢N ƒê·ªí" CHO QUERY)**

- **Execution Plan (K·∫ø ho·∫°ch Th·ª±c thi):** L√† b·∫£n ƒë·ªì chi ti·∫øt v·ªÅ c√°c b∆∞·ªõc m√† SQL Server th·ª±c hi·ªán ƒë·ªÉ ch·∫°y m·ªôt c√¢u l·ªánh
  SQL (nh∆∞ `SELECT`, `INSERT`, `UPDATE`, `DELETE`).
- **N√≥ ho·∫°t ƒë·ªông nh∆∞ th·∫ø n√†o?**
    - Gi·ªëng nh∆∞ khi b·∫°n ƒëi du l·ªãch: Google Maps s·∫Ω ch·ªâ cho b·∫°n ƒë∆∞·ªùng ƒëi, v√† Execution Plan c≈©ng v·∫≠y, n√≥ ch·ªâ cho b·∫°n con
      ƒë∆∞·ªùng m√† SQL Server ƒëi ƒë·ªÉ l·∫•y/s·ª≠a/x√≥a d·ªØ li·ªáu.
- **Quan tr·ªçng v√¨:**
    - **Hi·ªÉu c√°ch query ch·∫°y:** Bi·∫øt SQL Server l√†m g√¨ b√™n trong.
    - **T√¨m ƒëi·ªÉm y·∫øu:** Ph√°t hi·ªán c√°c b∆∞·ªõc ch·∫°y ch·∫≠m, t·ªën t√†i nguy√™n.
    - **T·ªëi ∆∞u:** C·∫£i thi·ªán query ƒë·ªÉ ch·∫°y nhanh h∆°n, hi·ªáu qu·∫£ h∆°n.

### **II. C√ÅC TH√ÄNH PH·∫¶N CH√çNH C·ª¶A EXECUTION PLAN (NH·ªÆNG "ƒê·ªäA DANH" TR√äN B·∫¢N ƒê·ªí)**

1. **Operators (To√°n t·ª≠):** C√°c "c·ªôt m·ªëc" tr√™n ƒë∆∞·ªùng ƒëi, bi·ªÉu di·ªÖn c√°c h√†nh ƒë·ªông c·ªßa SQL Server (v√≠ d·ª•: `Table Scan`,
   `Index Seek`, `Sort`, `Hash Match`).
2. **Arrows (M≈©i t√™n):** Ch·ªâ th·ª© t·ª± th·ª±c hi·ªán (d√≤ng ch·∫£y d·ªØ li·ªáu).
3. **Cost (Chi ph√≠):** ∆Ø·ªõc t√≠nh chi ph√≠ c·ªßa t·ª´ng to√°n t·ª≠, gi√∫p nh·∫≠n bi·∫øt c√°c to√°n t·ª≠ t·ªën t√†i nguy√™n.
4. **Cardinality (B·∫£n s·ªë):** ∆Ø·ªõc t√≠nh s·ªë l∆∞·ª£ng d√≤ng d·ªØ li·ªáu ƒëi qua m·ªói to√°n t·ª≠.
5. **Properties (Thu·ªôc t√≠nh):** Th√¥ng tin chi ti·∫øt v·ªÅ to√°n t·ª≠ (b·∫£ng, c·ªôt, index, ...).

### **III. C√ÅCH XEM EXECUTION PLAN (C√ÅCH "M·ªû B·∫¢N ƒê·ªí")**

1. **SQL Server Management Studio (SSMS):**
    - M·ªü SSMS, vi·∫øt c√¢u l·ªánh SQL.
    - B·∫•m n√∫t "Display Estimated Execution Plan" (Ctrl+L) ƒë·ªÉ xem k·∫ø ho·∫°ch ∆∞·ªõc t√≠nh.
    - B·∫•m n√∫t "Display Actual Execution Plan" (Ctrl+M) ƒë·ªÉ xem k·∫ø ho·∫°ch th·ª±c t·∫ø.
2. **Azure Data Studio:**
    - T∆∞∆°ng t·ª± SSMS, nh∆∞ng giao di·ªán kh√°c m·ªôt ch√∫t.

### **IV. C√ÅC TO√ÅN T·ª¨ TH∆Ø·ªúNG G·∫∂P (NH·ªÆNG "ƒê·ªäA DANH" QUEN THU·ªòC)**

1. **`Table Scan`:** ƒê·ªçc to√†n b·ªô d·ªØ li·ªáu c·ªßa b·∫£ng (nh∆∞ "ƒëi h·∫øt c·∫£ khu").
    - **X·∫•u:** Th∆∞·ªùng ch·∫≠m, n√™n tr√°nh v·ªõi b·∫£ng l·ªõn.
2. **`Index Seek`:** T√¨m d·ªØ li·ªáu b·∫±ng index (nh∆∞ "ƒëi t·∫Øt").
    - **T·ªët:** Nhanh, d√πng khi c√≥ index t·ªët.
3. **`Index Scan`:** Duy·ªát qua to√†n b·ªô index (nh∆∞ "ƒëi d·∫°o" trong danh s√°ch index).
    - **Kh√¥ng t·ªët:** Th∆∞·ªùng kh√¥ng nhanh b·∫±ng `Index Seek`.
4. **`Sort`:** S·∫Øp x·∫øp d·ªØ li·ªáu (t·ªën th·ªùi gian v√† b·ªô nh·ªõ).
    - **N√™n tr√°nh:** Khi kh√¥ng th·ª±c s·ª± c·∫ßn thi·∫øt.
5. **`Hash Match`:** D√πng ƒë·ªÉ k·∫øt h·ª£p d·ªØ li·ªáu t·ª´ 2 b·∫£ng (th∆∞·ªùng d√πng trong JOIN).
    - **C√≥ th·ªÉ ch·∫≠m:** V·ªõi b·∫£ng l·ªõn.
6. **`Nested Loops`:** K·∫øt h·ª£p d·ªØ li·ªáu b·∫±ng c√°ch loop qua c√°c b·∫£n ghi c·ªßa 2 b·∫£ng.
    - **C√≥ th·ªÉ ch·∫≠m:** V·ªõi b·∫£ng l·ªõn.
7. **`Merge Join`:** K·∫øt h·ª£p d·ªØ li·ªáu b·∫±ng c√°ch merge c√°c b·∫£n ghi ƒë√£ s·∫Øp x·∫øp (nhanh h∆°n Nested Loops n·∫øu d·ªØ li·ªáu ƒë√£ s·∫Øp
   x·∫øp).
8. **`Clustered Index Scan`:** Duy·ªát to√†n b·ªô clustered index c·ªßa b·∫£ng.
9. **`Clustered Index Seek`:** T√¨m d·ªØ li·ªáu b·∫±ng clustered index.
10. **`Key Lookup`:** Sau khi t√¨m index, c·∫ßn lookup v√†o b·∫£ng ƒë·ªÉ l·∫•y c√°c c·ªôt kh√¥ng c√≥ trong index.
    - **C√≥ th·ªÉ ch·∫≠m:** N·∫øu ph·∫£i lookup nhi·ªÅu.

### **V. V√ç D·ª§ MINH H·ªåA (XEM "TH·ª∞C H√ÄNH")**

#### **5.1. M·ªòT QUERY ƒê∆†N GI·∫¢N (KH√îNG INDEX):**

```sql
SELECT *
FROM Employees
WHERE Department = 'HR';
```

- **Execution Plan:** Th∆∞·ªùng c√≥ `Table Scan` (ƒë·ªçc to√†n b·ªô b·∫£ng).
- **L·ªùi khuy√™n:** N√™n t·∫°o index tr√™n c·ªôt `Department`.

#### **5.2. QUERY D√ôNG INDEX:**

```sql
SELECT FirstName, LastName, Salary
FROM Employees
WHERE EmployeeID = 10;
```

- **Execution Plan:** C√≥ `Index Seek` (truy c·∫≠p index nhanh).
- **L·ªùi khuy√™n:** T·∫°o index tr√™n `EmployeeID` n·∫øu ch∆∞a c√≥.

#### **5.3. QUERY D√ôNG JOIN:**

```sql
SELECT e.FirstName, e.LastName, d.DepartmentName
FROM Employees AS e
INNER JOIN Departments AS d
ON e.DepartmentID = d.DepartmentID;
```

- **Execution Plan:** C√≥ th·ªÉ c√≥ `Nested Loops`, `Hash Match` ho·∫∑c `Merge Join`.
- **L·ªùi khuy√™n:** T·∫°o index tr√™n c√°c c·ªôt `JOIN`.

### **VI. M·ªòT S·ªê M·∫∏O KHI PH√ÇN T√çCH EXECUTION PLAN (ƒê·ªÇ "ƒê·ªåC B·∫¢N ƒê·ªí" T·ªêT H∆†N)**

1. **T√¨m c√°c to√°n t·ª≠ t·ªën nhi·ªÅu chi ph√≠:** To√°n t·ª≠ c√≥ chi ph√≠ cao th∆∞·ªùng l√† ƒëi·ªÉm "ngh·∫Ωn c·ªï chai".
2. **Xem cardinality:** ƒê·ªÉ bi·∫øt s·ªë l∆∞·ª£ng d√≤ng d·ªØ li·ªáu ƒëi qua t·ª´ng to√°n t·ª≠.
3. **ƒê·ªçc t·ª´ ph·∫£i sang tr√°i:** C√°c to√°n t·ª≠ b√™n ph·∫£i th∆∞·ªùng ch·∫°y tr∆∞·ªõc (t√πy v√†o plan).
4. **Xem c√°c warnings:** N·∫øu c√≥ c·∫£nh b√°o, h√£y xem x√©t v√† kh·∫Øc ph·ª•c (thi·∫øu index, ...).
5. **So s√°nh k·∫ø ho·∫°ch th·ª±c t·∫ø v√† ∆∞·ªõc t√≠nh:** Xem c√≥ g√¨ kh√°c nhau kh√¥ng.
6. **Thay ƒë·ªïi code, xem l·∫°i plan:** T·ªëi ∆∞u code v√† ki·ªÉm tra l·∫°i Execution Plan ƒë·ªÉ th·∫•y hi·ªáu qu·∫£.

### **VII. K·∫æT LU·∫¨N (T·ªîNG K·∫æT)**

Execution Plan l√† "b·∫°n th√¢n" c·ªßa d√¢n code SQL, gi√∫p b·∫°n hi·ªÉu r√µ v√† t·ªëi ∆∞u h√≥a c√°c truy v·∫•n. Hy v·ªçng qua b√†i vi·∫øt n√†y,
c√°c b·∫°n ƒë√£ hi·ªÉu r√µ h∆°n v·ªÅ n√≥ v√† c√≥ th·ªÉ √°p d·ª•ng v√†o c√¥ng vi·ªác h√†ng ng√†y. Ch√∫c c√°c b·∫°n code th√†nh c√¥ng! üòé
