## **üöÄ "GI·∫¢I M√É" STORED PROCEDURES: "H√ÄM" TRONG DATABASE CHO D√ÇN CODE üöÄ**

Yo c√°c b·∫°n sinh vi√™n IT! H√¥m nay ch√∫ng ta s·∫Ω c√πng nhau "kh√°m ph√°" m·ªôt kh√°i ni·ªám c·ª±c k·ª≥ quan tr·ªçng trong SQL Server:
Stored Procedures (Th·ªß t·ª•c l∆∞u tr·ªØ). ƒê√¢y l√† m·ªôt "chi√™u th·ª©c" l·ª£i h·∫°i gi√∫p b·∫°n ƒë√≥ng g√≥i c√°c c√¢u l·ªánh SQL th√†nh m·ªôt "h√†m"
ƒë·ªÉ t√°i s·ª≠ d·ª•ng, tƒÉng hi·ªáu su·∫•t v√† b·∫£o m·∫≠t. C√πng m√¨nh "m·ªï x·∫ª" n√≥ nh√©!

### **I. STORED PROCEDURE L√Ä G√å? (NH∆Ø "H√ÄM" TRONG DATABASE)**

- **Stored Procedure (Th·ªß t·ª•c l∆∞u tr·ªØ):** L√† m·ªôt t·∫≠p h·ª£p c√°c c√¢u l·ªánh SQL ƒë∆∞·ª£c _l∆∞u tr·ªØ_ trong c∆° s·ªü d·ªØ li·ªáu (database).
- **N√≥ ho·∫°t ƒë·ªông nh∆∞ th·∫ø n√†o?**
    - Gi·ªëng nh∆∞ khi b·∫°n t·∫°o m·ªôt "macro" trong Excel: b·∫°n ghi l·∫°i m·ªôt lo·∫°t c√°c thao t√°c, r·ªìi l·∫ßn sau ch·ªâ c·∫ßn g·ªçi "macro"
      ƒë√≥ l√† th·ª±c hi·ªán y h·ªát.
- **Quan tr·ªçng v√¨:**
    - **T√°i s·ª≠ d·ª•ng:** D√πng l·∫°i c√°c c√¢u l·ªánh ph·ª©c t·∫°p ·ªü nhi·ªÅu n∆°i.
    - **Hi·ªáu su·∫•t:** Ch·∫°y nhanh h∆°n (do ƒë√£ bi√™n d·ªãch tr∆∞·ªõc).
    - **B·∫£o m·∫≠t:** Che gi·∫•u logic database (kh√¥ng ai th·∫•y code SQL b√™n trong).
    - **Qu·∫£n l√Ω:** Qu·∫£n l√Ω code database d·ªÖ h∆°n.

### **II. C√ÅCH T·∫†O STORED PROCEDURE (C√ÅCH "GHI MACRO")**

```sql
CREATE PROCEDURE procedure_name
    @parameter1 datatype,
    @parameter2 datatype,
    ...
AS
BEGIN
    -- C√¢u l·ªánh SQL
END;
```

- **`CREATE PROCEDURE procedure_name`:** T·∫°o stored procedure v·ªõi t√™n `procedure_name`.
- **`@parameter1 datatype, ...`:** C√°c tham s·ªë ƒë·∫ßu v√†o (n·∫øu c√≥).
- **`AS BEGIN ... END`:** Kh·ªëi code SQL.

### **III. V√ç D·ª§ MINH H·ªåA (XEM "TH·ª∞C H√ÄNH")**

1. **T·∫°o stored procedure l·∫•y th√¥ng tin nh√¢n vi√™n theo Department:**

```sql
CREATE PROCEDURE GetEmployeesByDepartment
    @DepartmentName VARCHAR(100)
AS
BEGIN
    SELECT FirstName, LastName, Email, Salary
    FROM Employees
    WHERE Department = @DepartmentName;
END;
```

- **Gi·∫£i th√≠ch:** T·∫°o procedure t√™n `GetEmployeesByDepartment` ƒë·ªÉ l·∫•y th√¥ng tin nh√¢n vi√™n theo t√™n ph√≤ng ban (tham s·ªë).

2. **T·∫°o stored procedure t√≠nh t·ªïng l∆∞∆°ng c·ªßa m·ªôt ph√≤ng ban:**

```sql
CREATE PROCEDURE GetTotalSalaryByDepartment
    @DepartmentName VARCHAR(100)
AS
BEGIN
    SELECT Department, SUM(Salary) AS TotalSalary
    FROM Employees
    WHERE Department = @DepartmentName
    GROUP BY Department;
END;
```

- **Gi·∫£i th√≠ch:** T·∫°o procedure t√™n `GetTotalSalaryByDepartment` ƒë·ªÉ t√≠nh t·ªïng l∆∞∆°ng theo t√™n ph√≤ng ban.

3. **T·∫°o stored procedure th√™m m·ªõi nh√¢n vi√™n:**

```sql
CREATE PROCEDURE AddNewEmployee
    @FirstName VARCHAR(100),
    @LastName VARCHAR(100),
    @Department VARCHAR(100),
    @Salary DECIMAL(10,2)
AS
BEGIN
    INSERT INTO Employees (FirstName, LastName, Department, Salary)
    VALUES (@FirstName, @LastName, @Department, @Salary);
END;
```

- **Gi·∫£i th√≠ch:** T·∫°o procedure t√™n `AddNewEmployee` ƒë·ªÉ th√™m m·ªõi nh√¢n vi√™n v√†o b·∫£ng.

### **IV. C√ÅCH G·ªåI STORED PROCEDURE (C√ÅCH D√ôNG "MACRO")**

```sql
EXEC procedure_name @parameter1 = value1, @parameter2 = value2, ...;
```

- **`EXEC procedure_name`:** G·ªçi procedure v·ªõi t√™n `procedure_name`.
- **`@parameter1 = value1, ...`:** Truy·ªÅn gi√° tr·ªã cho c√°c tham s·ªë (n·∫øu c√≥).
- **V√≠ d·ª•:**

```sql
EXEC GetEmployeesByDepartment @DepartmentName = 'HR';
```

```sql
EXEC GetTotalSalaryByDepartment @DepartmentName = 'IT';
```

```sql
EXEC AddNewEmployee @FirstName = 'Jane', @LastName = 'Doe', @Department = 'Sales', @Salary = 6000;
```

### **V. ∆ØU ƒêI·ªÇM C·ª¶A STORED PROCEDURE (ƒêI·ªÇM "ƒê√ÅNG Y√äU")**

- **T√°i s·ª≠ d·ª•ng:** Code m·ªôt l·∫ßn, d√πng nhi·ªÅu n∆°i.
- **Hi·ªáu su·∫•t:** Ch·∫°y nhanh h∆°n v√¨ ƒë√£ bi√™n d·ªãch tr∆∞·ªõc (l·∫ßn ƒë·∫ßu g·ªçi).
- **B·∫£o m·∫≠t:** Kh√¥ng ƒë·ªÉ l·ªô code SQL cho ng∆∞·ªùi d√πng.
- **D·ªÖ qu·∫£n l√Ω:** Code database t·∫≠p trung, d·ªÖ qu·∫£n l√Ω.

### **VI. NH∆Ø·ª¢C ƒêI·ªÇM C·ª¶A STORED PROCEDURE (ƒêI·ªÇM "KH√ì CH·ªäU")**

- **Kh√≥ debug:** Kh√≥ debug h∆°n so v·ªõi c√°c c√¢u l·ªánh SQL th√¥ng th∆∞·ªùng.
- **Kh√≥ qu·∫£n l√Ω phi√™n b·∫£n:** C·∫ßn ch√∫ √Ω khi c√≥ thay ƒë·ªïi (nh·∫•t l√† khi nhi·ªÅu ng∆∞·ªùi c√πng l√†m).

### **VII. L∆ØU √ù QUAN TR·ªåNG (ƒê·ªÇ KH√îNG B·ªä "SAI S√ìT")**

- **T√™n r√µ r√†ng:** ƒê·∫∑t t√™n procedure d·ªÖ hi·ªÉu.
- **Comment:** Vi·∫øt comment cho c√°c procedure ph·ª©c t·∫°p.
- **Ki·ªÉm th·ª≠:** Test k·ªπ tr∆∞·ªõc khi d√πng (ch·∫°y th·ª≠, ki·ªÉm tra l·ªói).
- **Quy·ªÅn:** Ph√¢n quy·ªÅn cho ng∆∞·ªùi d√πng ƒë∆∞·ª£c ph√©p ch·∫°y procedure.
- **T·ªëi ∆∞u:** C·∫ßn t·ªëi ∆∞u code SQL b√™n trong procedure.

### **VIII. ·ª®NG D·ª§NG (ƒê∆Ø·ª¢C D√ôNG ·ªû ƒê√ÇU?)**

- **Logic nghi·ªáp v·ª•:** ƒê√≥ng g√≥i c√°c nghi·ªáp v·ª• ph·ª©c t·∫°p.
- **B·∫£o m·∫≠t:** Ki·ªÉm so√°t quy·ªÅn truy c·∫≠p d·ªØ li·ªáu.
- **B√°o c√°o:** T·∫°o c√°c b√°o c√°o t·ªïng h·ª£p.
- **T√°i s·ª≠ d·ª•ng:** D√πng l·∫°i c√°c truy v·∫•n, c√°c thao t√°c th∆∞·ªùng d√πng.

### **IX. K·∫æT LU·∫¨N (T·ªîNG K·∫æT)**

Stored Procedure l√† m·ªôt c√¥ng c·ª• m·∫°nh m·∫Ω gi√∫p b·∫°n t·ªï ch·ª©c, b·∫£o m·∫≠t v√† t·ªëi ∆∞u code database c·ªßa m√¨nh. Hy v·ªçng qua b√†i vi·∫øt
n√†y, c√°c b·∫°n ƒë√£ hi·ªÉu r√µ h∆°n v·ªÅ n√≥ v√† c√≥ th·ªÉ √°p d·ª•ng v√†o c√¥ng vi·ªác h√†ng ng√†y. Ch√∫c c√°c b·∫°n code th√†nh c√¥ng! üòé
