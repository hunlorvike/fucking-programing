## **üöÄ "GI·∫¢I M√É" PH√ÇN V√ôNG (PARTITIONING): CHIA NH·ªé D·ªÆ LI·ªÜU L·ªöN TRONG SQL SERVER CHO D√ÇN CODE üöÄ**

Yo c√°c b·∫°n sinh vi√™n IT! H√¥m nay ch√∫ng ta s·∫Ω c√πng nhau "kh√°m ph√°" m·ªôt k·ªπ thu·∫≠t c·ª±c k·ª≥ quan tr·ªçng khi l√†m vi·ªác v·ªõi
database l·ªõn: Partitioning (Ph√¢n v√πng). ƒê√¢y l√† m·ªôt "chi√™u th·ª©c" gi√∫p b·∫°n "c∆∞a nh·ªè" d·ªØ li·ªáu kh·ªïng l·ªì, ƒë·ªÉ d·ªÖ qu·∫£n l√Ω v√†
truy v·∫•n h∆°n. C√πng m√¨nh "m·ªï x·∫ª" n√≥ nh√©!

### **I. PH√ÇN V√ôNG (PARTITIONING) L√Ä G√å? (CHIA NH·ªé "KHO" D·ªÆ LI·ªÜU)**

- **Partitioning (Ph√¢n v√πng):** L√† k·ªπ thu·∫≠t chia m·ªôt b·∫£ng l·ªõn th√†nh c√°c ph·∫ßn nh·ªè h∆°n (partition) ƒë·ªÉ:
    - Qu·∫£n l√Ω d·ªØ li·ªáu d·ªÖ h∆°n.
    - TƒÉng t·ªëc ƒë·ªô truy v·∫•n.
    - Gi·∫£m t·∫£i cho database.
- **N√≥ ho·∫°t ƒë·ªông nh∆∞ th·∫ø n√†o?**
    - Gi·ªëng nh∆∞ khi b·∫°n chia ƒë·ªì trong t·ªß: b·∫°n chia theo lo·∫°i (qu·∫ßn √°o, s√°ch, ƒë·ªì ch∆°i, ...) ƒë·ªÉ d·ªÖ t√¨m, d·ªÖ qu·∫£n l√Ω.
- **Quan tr·ªçng v√¨:**
    - **Hi·ªáu su·∫•t:** Truy v·∫•n nhanh h∆°n (v√¨ ch·ªâ c·∫ßn t√¨m trong 1 partition).
    - **Qu·∫£n l√Ω:** Qu·∫£n l√Ω d·ªØ li·ªáu l·ªõn d·ªÖ d√†ng h∆°n.
    - **Linh ho·∫°t:** C√≥ th·ªÉ ph√¢n v√πng theo nhi·ªÅu c√°ch kh√°c nhau.

### **II. C√ÅC LO·∫†I PH√ÇN V√ôNG (C√ÅCH CHIA "KHO")**

1. **Ph√¢n v√πng ngang (Horizontal Partitioning):**
    - Chia b·∫£ng theo h√†ng (d√≤ng d·ªØ li·ªáu).
    - Th∆∞·ªùng d√πng khi c√≥ c·ªôt th·ªùi gian, v√πng, ...
    - **V√≠ d·ª•:** Chia b·∫£ng `Orders` theo nƒÉm.
2. **Ph√¢n v√πng d·ªçc (Vertical Partitioning):**
    - Chia b·∫£ng theo c·ªôt (chia th√†nh nhi·ªÅu b·∫£ng con, m·ªói b·∫£ng con c√≥ m·ªôt s·ªë c·ªôt).
    - Th∆∞·ªùng d√πng khi c√≥ m·ªôt s·ªë c·ªôt √≠t d√πng.
    - **V√≠ d·ª•:** T√°ch c√°c c·ªôt √≠t d√πng (h√¨nh ·∫£nh, note, ...) sang b·∫£ng kh√°c.

### **III. C√ÅCH PH√ÇN V√ôNG B·∫¢NG (C√ÅCH CHIA "T·ª¶")**

#### **3.1. RANGE PARTITIONING (PH√ÇN V√ôNG THEO KHO·∫¢NG)**

- Chia theo kho·∫£ng gi√° tr·ªã c·ªßa m·ªôt c·ªôt.
- **V√≠ d·ª•:** Chia theo nƒÉm, theo th√°ng, theo v√πng,...
- **Code:**

```sql
CREATE PARTITION FUNCTION partition_by_year (datetime)
AS RANGE RIGHT FOR VALUES ('2020-01-01', '2021-01-01', '2022-01-01');

CREATE PARTITION SCHEME partition_scheme_by_year
AS PARTITION partition_by_year
TO ([PRIMARY], [SECONDARY], [TERTIARY], [QUATERNARY]);

CREATE TABLE Orders (
    OrderID INT PRIMARY KEY,
    OrderDate DATETIME,
    CustomerID INT
)
ON partition_scheme_by_year (OrderDate);
```

**Gi·∫£i th√≠ch:**

- T·∫°o function `partition_by_year` ƒë·ªÉ ƒë·ªãnh nghƒ©a c√°c kho·∫£ng.
- T·∫°o scheme `partition_scheme_by_year` ƒë·ªÉ x√°c ƒë·ªãnh partition s·∫Ω l∆∞u ·ªü filegroup n√†o.
- T·∫°o b·∫£ng `Orders` v·ªõi partition function v√† scheme.

#### **3.2. LIST PARTITIONING (PH√ÇN V√ôNG THEO DANH S√ÅCH)**

- Chia theo danh s√°ch c√°c gi√° tr·ªã.
- **V√≠ d·ª•:** Chia theo v√πng (region), theo lo·∫°i s·∫£n ph·∫©m,...

```sql
CREATE PARTITION FUNCTION partition_by_region (VARCHAR(20))
AS LIST ( 'North', 'South', 'East', 'West');

CREATE PARTITION SCHEME partition_scheme_by_region
AS PARTITION partition_by_region
TO ([PRIMARY], [SECONDARY], [TERTIARY], [QUATERNARY]);

CREATE TABLE Customers (
    CustomerID INT PRIMARY KEY,
    Region VARCHAR(20),
    CustomerName VARCHAR(100)
)
ON partition_scheme_by_region (Region);
```

**Gi·∫£i th√≠ch:**

- T·∫°o function `partition_by_region` ƒë·ªÉ ƒë·ªãnh nghƒ©a c√°c v√πng.
- T·∫°o scheme `partition_scheme_by_region` ƒë·ªÉ x√°c ƒë·ªãnh partition s·∫Ω l∆∞u ·ªü filegroup n√†o.
- T·∫°o b·∫£ng `Customers` v·ªõi partition function v√† scheme.

#### **3.3. HASH PARTITIONING (PH√ÇN V√ôNG THEO HASH)**

- Chia d·ª±a tr√™n gi√° tr·ªã bƒÉm c·ªßa m·ªôt c·ªôt (ph√¢n ph·ªëi ƒë·ªÅu d·ªØ li·ªáu).
- **V√≠ d·ª•:** Chia d·ª±a tr√™n ID c·ªßa ng∆∞·ªùi d√πng (CustomerID).

```sql
CREATE PARTITION FUNCTION partition_by_customer_id(INT)
AS RANGE RIGHT FOR VALUES (100, 200, 300)

CREATE PARTITION SCHEME partition_scheme_by_customer_id
AS PARTITION partition_by_customer_id
TO ([PRIMARY], [SECONDARY], [TERTIARY], [QUATERNARY]);

CREATE TABLE Products (
    ProductID INT PRIMARY KEY,
    ProductName VARCHAR(100),
    CustomerID INT
)
ON partition_scheme_by_customer_id(CustomerID);
```

**Gi·∫£i th√≠ch:**

- T·∫°o function `partition_by_customer_id` ƒë·ªÉ ƒë·ªãnh nghƒ©a c√°ch ph√¢n chia d·ª±a theo ID kh√°ch h√†ng.
- T·∫°o scheme `partition_scheme_by_customer_id` ƒë·ªÉ x√°c ƒë·ªãnh partition s·∫Ω l∆∞u ·ªü filegroup n√†o.
- T·∫°o b·∫£ng `Products` v·ªõi partition function v√† scheme.

### **IV. L·ª¢I √çCH C·ª¶A PH√ÇN V√ôNG (T·∫†I SAO N√äN CHIA "T·ª¶")**

- **Hi·ªáu su·∫•t:** Gi√∫p query nhanh h∆°n (ch·ªâ c·∫ßn t√¨m trong m·ªôt partition).
- **Qu·∫£n l√Ω:** D·ªÖ qu·∫£n l√Ω d·ªØ li·ªáu l·ªõn (backup, restore, ... d·ªÖ h∆°n).
- **T√≠nh kh·∫£ d·ª•ng:** TƒÉng t√≠nh s·∫µn s√†ng (kh√¥ng b·ªã s·∫≠p h·∫øt n·∫øu m·ªôt partition b·ªã l·ªói).

### **V. NH∆Ø·ª¢C ƒêI·ªÇM C·ª¶A PH√ÇN V√ôNG (C·∫®N TH·∫¨N KHI CHIA "T·ª¶")**

- **Ph·ª©c t·∫°p:** C·∫ßn ph·∫£i c√≥ ki·∫øn th·ª©c v·ªÅ database, ch·ªçn c·ªôt ph√¢n v√πng h·ª£p l√Ω.
- **C·∫•u h√¨nh ph·ª©c t·∫°p:** C·∫•u h√¨nh partition scheme, partition function.
- **T·ªën b·ªô nh·ªõ:** C√≥ th·ªÉ t·ªën b·ªô nh·ªõ ƒë·ªÉ l∆∞u tr·ªØ metadata v·ªÅ partition.

### **VI. L∆ØU √ù QUAN TR·ªåNG (ƒê·ªÇ KH√îNG B·ªä "SAI S√ìT")**

- **Ch·ªçn c·ªôt ph√¢n v√πng:** Ch·ªçn c·ªôt ph√¢n v√πng c·∫©n th·∫≠n ƒë·ªÉ d·ªØ li·ªáu ph√¢n b·ªë ƒë·ªÅu, tr√°nh b·ªã l·ªách.
- **Test k·ªπ:** Ki·ªÉm tra k·ªπ tr∆∞·ªõc khi √°p d·ª•ng v√†o production (ƒë·ªÉ tr√°nh b·ªã m·∫•t d·ªØ li·ªáu).
- **Qu·∫£n l√Ω:** N√™n c√≥ k·∫ø ho·∫°ch qu·∫£n l√Ω partition th∆∞·ªùng xuy√™n.

### **VII. K·∫æT LU·∫¨N (T·ªîNG K·∫æT)**

Partitioning l√† m·ªôt k·ªπ thu·∫≠t r·∫•t m·∫°nh m·∫Ω, gi√∫p b·∫°n qu·∫£n l√Ω v√† truy v·∫•n d·ªØ li·ªáu l·ªõn m·ªôt c√°ch hi·ªáu qu·∫£ h∆°n. Hy v·ªçng qua
b√†i vi·∫øt n√†y, c√°c b·∫°n ƒë√£ hi·ªÉu r√µ h∆°n v·ªÅ n√≥ v√† c√≥ th·ªÉ √°p d·ª•ng v√†o d·ª± √°n c·ªßa m√¨nh. Ch√∫c c√°c b·∫°n code th√†nh c√¥ng! üòé
