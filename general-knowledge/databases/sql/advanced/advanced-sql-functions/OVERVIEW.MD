## **üöÄ "GI·∫¢I M√É" C√ÅC H√ÄM N√ÇNG CAO TRONG SQL SERVER: "V≈® KH√ç" PH√ÇN T√çCH D·ªÆ LI·ªÜU CHO D√ÇN CODE üöÄ**

Yo c√°c b·∫°n sinh vi√™n IT! H√¥m nay ch√∫ng ta s·∫Ω c√πng nhau "kh√°m ph√°" m·ªôt nh√≥m h√†m c·ª±c k·ª≥ quan tr·ªçng trong SQL Server: C√°c
h√†m n√¢ng cao (Advanced Functions). ƒê√¢y l√† nh·ªØng "chi√™u th·ª©c" l·ª£i h·∫°i gi√∫p b·∫°n l√†m ch·ªß d·ªØ li·ªáu, gi·∫£i quy·∫øt c√°c b√†i to√°n
ph·ª©c t·∫°p v√† t·∫°o ra nh·ªØng b√°o c√°o chuy√™n s√¢u. C√πng m√¨nh "m·ªï x·∫ª" ch√∫ng nh√©!

### **I. H√ÄM N√ÇNG CAO L√Ä G√å? (L√ÄM G√å ƒê∆Ø·ª¢C?)**

- **H√†m n√¢ng cao (Advanced Functions):** L√† c√°c h√†m trong SQL Server cung c·∫•p c√°c ch·ª©c nƒÉng ph·ª©c t·∫°p h∆°n, ngo√†i c√°c h√†m
  c∆° b·∫£n nh∆∞ `SUM`, `AVG`, `COUNT`.
- **N√≥ ho·∫°t ƒë·ªông nh∆∞ th·∫ø n√†o?**
    - Gi·ªëng nh∆∞ khi b·∫°n c√≥ m·ªôt con dao ƒëa nƒÉng: c√≥ th·ªÉ c·∫Øt, g·ªçt, b√†o,... nhi·ªÅu th·ª© kh√°c nhau (thay v√¨ ch·ªâ c·∫Øt).
- **Quan tr·ªçng v√¨:**
    - **Ph√¢n t√≠ch d·ªØ li·ªáu:** Gi√∫p b·∫°n ph√¢n t√≠ch d·ªØ li·ªáu s√¢u h∆°n, t·∫°o ra insight (th√¥ng tin gi√° tr·ªã).
    - **T√≠nh to√°n ph·ª©c t·∫°p:** Th·ª±c hi·ªán c√°c t√≠nh to√°n ph·ª©c t·∫°p h∆°n tr√™n d·ªØ li·ªáu.
    - **L√†m ƒë·∫πp d·ªØ li·ªáu:** Chuy·ªÉn ƒë·ªïi, ƒë·ªãnh d·∫°ng d·ªØ li·ªáu theo √Ω mu·ªën.
    - **T·ªëi ∆∞u truy v·∫•n:** D√πng c√°c h√†m window ƒë·ªÉ t·ªëi ∆∞u c√°c truy v·∫•n ph·ª©c t·∫°p.

### **II. C√ÅC H√ÄM N√ÇNG CAO PH·ªî BI·∫æN (NH·ªÆNG "CHI√äU" TH∆Ø·ªúNG D√ôNG)**

1. **H√†m Window (Window Functions):** T√≠nh to√°n tr√™n m·ªôt t·∫≠p h·ª£p c√°c d√≤ng (window) li√™n quan ƒë·∫øn d√≤ng hi·ªán t·∫°i (v√≠ d·ª•:
   `ROW_NUMBER()`, `RANK()`, `DENSE_RANK()`, `LAG()`, `LEAD()`).
2. **H√†m Chu·ªói (String Functions):** Thao t√°c v·ªõi chu·ªói k√Ω t·ª± (`SUBSTRING()`, `LEFT()`, `RIGHT()`, `LEN()`, `UPPER()`,
   `LOWER()`, `REPLACE()`, `TRIM()`).
3. **H√†m Ng√†y v√† Gi·ªù (Date and Time Functions):** Thao t√°c v·ªõi ng√†y v√† gi·ªù (`GETDATE()`, `DATEADD()`, `DATEDIFF()`,
   `DATEPART()`, `FORMAT()`).
4. **H√†m To√°n h·ªçc (Mathematical Functions):** T√≠nh to√°n s·ªë h·ªçc (`ABS()`, `ROUND()`, `FLOOR()`, `CEILING()`, `POWER()`,
   `SQRT()`, `RAND()`).
5. **H√†m Chuy·ªÉn ƒë·ªïi (Conversion Functions):** Chuy·ªÉn ƒë·ªïi gi·ªØa c√°c ki·ªÉu d·ªØ li·ªáu (`CONVERT()`, `CAST()`).
6. **H√†m Logic (Logical Functions):** Th·ª±c hi·ªán c√°c ph√©p logic (`IIF()`, `CASE WHEN`).
7. **H√†m BƒÉm (Hash Functions):** T·∫°o gi√° tr·ªã bƒÉm c·ªßa d·ªØ li·ªáu (`CHECKSUM()`, `HASHBYTES()`).
8. **H√†m JSON (JSON Functions):** L√†m vi·ªác v·ªõi d·ªØ li·ªáu JSON (`JSON_VALUE()`, `JSON_QUERY()`, `FOR JSON`).

### **III. V√ç D·ª§ MINH H·ªåA (XEM "TH·ª∞C H√ÄNH")**

#### **1. H√ÄM WINDOW (WINDOW FUNCTIONS)**

```sql
SELECT
    FirstName,
    LastName,
    Salary,
    RANK() OVER (ORDER BY Salary DESC) AS SalaryRank
FROM Employees;
```

- **Gi·∫£i th√≠ch:** L·∫•y t√™n, l∆∞∆°ng v√† x·∫øp h·∫°ng l∆∞∆°ng c·ªßa nh√¢n vi√™n (t√≠nh h·∫°ng theo l∆∞∆°ng).
- **`RANK() OVER (ORDER BY Salary DESC)`:** X·∫øp h·∫°ng theo l∆∞∆°ng t·ª´ cao ƒë·∫øn th·∫•p.

#### **2. H√ÄM CHU·ªñI (STRING FUNCTIONS)**

```sql
SELECT
    FirstName,
    LEFT(FirstName, 3) AS ShortName,
    UPPER(LastName) AS LastNameUpper,
    REPLACE(FirstName, 'John', 'Jon') AS FirstNameReplaced
FROM Employees
WHERE LEN(FirstName) > 3;
```

- **Gi·∫£i th√≠ch:** L·∫•y t√™n, r√∫t g·ªçn t√™n, vi·∫øt hoa h·ªç v√† thay th·∫ø t√™n "John" th√†nh "Jon".
- **`LEFT(FirstName, 3)`:** L·∫•y 3 k√Ω t·ª± ƒë·∫ßu c·ªßa t√™n.
- **`UPPER(LastName)`:** Vi·∫øt hoa h·ªç.
- **`REPLACE(FirstName, 'John', 'Jon')`:** Thay th·∫ø "John" b·∫±ng "Jon".
- **`LEN(FirstName) > 3`:** L·ªçc c√°c nh√¢n vi√™n c√≥ t√™n d√†i h∆°n 3 k√Ω t·ª±.

#### **3. H√ÄM NG√ÄY V√Ä GI·ªú (DATE AND TIME FUNCTIONS)**

```sql
SELECT
    OrderDate,
    DATEADD(day, 7, OrderDate) AS DueDate,
    DATEDIFF(day, OrderDate, GETDATE()) AS DaysSinceOrder,
    FORMAT(OrderDate, 'dd/MM/yyyy') AS FormattedOrderDate
FROM Orders;
```

- **Gi·∫£i th√≠ch:** L·∫•y ng√†y ƒë·∫∑t h√†ng, ng√†y ƒë√°o h·∫°n (sau 7 ng√†y), s·ªë ng√†y t·ª´ ng√†y ƒë·∫∑t h√†ng ƒë·∫øn hi·ªán t·∫°i, v√† format l·∫°i
  ng√†y ƒë·∫∑t h√†ng.
- **`DATEADD(day, 7, OrderDate)`:** C·ªông 7 ng√†y v√†o ng√†y ƒë·∫∑t h√†ng.
- **`DATEDIFF(day, OrderDate, GETDATE())`:** T√≠nh s·ªë ng√†y t·ª´ ng√†y ƒë·∫∑t h√†ng ƒë·∫øn hi·ªán t·∫°i.
- **`FORMAT(OrderDate, 'dd/MM/yyyy')`:** ƒê·ªãnh d·∫°ng ng√†y theo ki·ªÉu `dd/MM/yyyy`.

#### **4. H√ÄM TO√ÅN H·ªåC (MATHEMATICAL FUNCTIONS)**

```sql
SELECT
    Salary,
    ROUND(Salary, 0) AS RoundedSalary,
    ABS(Salary - 5000) AS SalaryDiff,
    SQRT(Salary) AS SalarySqrt
FROM Employees
WHERE Department = 'IT';
```

- **Gi·∫£i th√≠ch:** L·∫•y l∆∞∆°ng, l√†m tr√≤n l∆∞∆°ng, ƒë·ªô l·ªách l∆∞∆°ng so v·ªõi 5000, v√† cƒÉn b·∫≠c 2 c·ªßa l∆∞∆°ng c·ªßa nh√¢n vi√™n ph√≤ng IT.
- **`ROUND(Salary, 0)`:** L√†m tr√≤n l∆∞∆°ng v·ªÅ s·ªë nguy√™n.
- **`ABS(Salary - 5000)`:** T√≠nh gi√° tr·ªã tuy·ªát ƒë·ªëi c·ªßa hi·ªáu s·ªë l∆∞∆°ng v√† 5000.
- **`SQRT(Salary)`:** T√≠nh cƒÉn b·∫≠c hai c·ªßa l∆∞∆°ng.

#### **5. H√ÄM CHUY·ªÇN ƒê·ªîI (CONVERSION FUNCTIONS)**

```sql
SELECT
    OrderID,
    CONVERT(VARCHAR(10), OrderDate, 103) AS OrderDateStr,
    CAST(Salary AS DECIMAL(10, 2)) AS SalaryDecimal
FROM Orders
JOIN Employees
ON Orders.EmployeeID = Employees.EmployeeID
WHERE Department = 'Sales';
```

- **Gi·∫£i th√≠ch:** L·∫•y ID ƒë∆°n h√†ng, ng√†y ƒë·∫∑t h√†ng d·∫°ng chu·ªói v√† l∆∞∆°ng d·∫°ng decimal.
- **`CONVERT(VARCHAR(10), OrderDate, 103)`:** Chuy·ªÉn ng√†y th√†nh chu·ªói theo format `dd/MM/yyyy`.
- **`CAST(Salary AS DECIMAL(10, 2))`:** Chuy·ªÉn l∆∞∆°ng th√†nh s·ªë decimal v·ªõi 2 ch·ªØ s·ªë th·∫≠p ph√¢n.

#### **6. H√ÄM LOGIC (LOGICAL FUNCTIONS)**

```sql
SELECT
    FirstName,
    LastName,
    Salary,
    IIF(Salary > 7000, 'High Salary', 'Low Salary') AS SalaryLevel,
    CASE
        WHEN Department = 'IT' THEN 'Technical'
        WHEN Department = 'Sales' THEN 'Commercial'
        ELSE 'Other'
    END AS DepartmentType
FROM Employees
WHERE Department IN ('IT', 'Sales', 'HR');
```

- **Gi·∫£i th√≠ch:** L·∫•y t√™n, l∆∞∆°ng, ph√¢n lo·∫°i l∆∞∆°ng v√† lo·∫°i ph√≤ng ban.
- **`IIF(Salary > 7000, 'High Salary', 'Low Salary')`:** N·∫øu l∆∞∆°ng > 7000 th√¨ 'High Salary', ng∆∞·ª£c l·∫°i th√¨ 'Low Salary'.
- **`CASE WHEN ... THEN ... ELSE ... END`:** Ph√¢n lo·∫°i ph√≤ng ban.

#### **7. H√ÄM BƒÇM (HASH FUNCTIONS)**

```sql
SELECT
    FirstName,
    LastName,
    HASHBYTES('SHA2_256', FirstName) AS FirstNameHash
FROM Employees
WHERE Department = 'IT';
```

- **Gi·∫£i th√≠ch:** L·∫•y t√™n v√† gi√° tr·ªã bƒÉm SHA2_256 c·ªßa t√™n.
- **`HASHBYTES('SHA2_256', FirstName)`:** T·∫°o hash value c·ªßa t√™n d√πng SHA2_256.

#### **8. H√ÄM JSON (JSON FUNCTIONS)**

```sql
SELECT
    OrderID,
    OrderDetails
    JSON_VALUE(OrderDetails, '$.items[0].product') AS FirstProduct,
    JSON_QUERY(OrderDetails, '$.items') AS Items
FROM Orders
WHERE OrderID = 100;
```

- **Gi·∫£i th√≠ch:** L·∫•y ID ƒë∆°n h√†ng, details d·∫°ng JSON, l·∫•y t√™n s·∫£n ph·∫©m ƒë·∫ßu ti√™n v√† m·∫£ng `items`.
- **`JSON_VALUE(OrderDetails, '$.items[0].product')`:** L·∫•y gi√° tr·ªã t·∫°i path `$.items[0].product`.
- **`JSON_QUERY(OrderDetails, '$.items')`:** L·∫•y m·∫£ng items d·∫°ng JSON.
-       **`FOR JSON AUTO`:** T·∫°o ra m·ªôt chu·ªói JSON t·ª´ k·∫øt qu·∫£ truy v·∫•n

```sql
    SELECT
      OrderID,
      OrderDate,
      CustomerID
        FROM Orders
     FOR JSON AUTO;
```

### **VIII. L∆ØU √ù QUAN TR·ªåNG (ƒê·ªÇ KH√îNG B·ªä "SAI S√ìT")**

- **Hi·ªÉu r√µ h√†m:** ƒê·ªçc k·ªπ t√†i li·ªáu v√† hi·ªÉu r√µ c√°ch d√πng c·ªßa t·ª´ng h√†m.
- **K·∫øt h·ª£p:** K·∫øt h·ª£p c√°c h√†m ƒë·ªÉ t·∫°o ra c√°c truy v·∫•n ph·ª©c t·∫°p h∆°n.
- **T·ªëi ∆∞u:** D√πng h√†m ƒë√∫ng c√°ch ƒë·ªÉ t·ªëi ∆∞u hi·ªáu su·∫•t query.

### **IX. K·∫æT LU·∫¨N (T·ªîNG K·∫æT)**

C√°c h√†m n√¢ng cao trong SQL Server l√† m·ªôt c√¥ng c·ª• m·∫°nh m·∫Ω gi√∫p b·∫°n ph√¢n t√≠ch v√† x·ª≠ l√Ω d·ªØ li·ªáu m·ªôt c√°ch hi·ªáu qu·∫£. H√£y s·ª≠
d·ª•ng ch√∫ng m·ªôt c√°ch linh ho·∫°t v√† s√°ng t·∫°o ƒë·ªÉ khai th√°c t·ªëi ƒëa ti·ªÅm nƒÉng c·ªßa d·ªØ li·ªáu. Ch√∫c c√°c b·∫°n code th√†nh c√¥ng! üòé
