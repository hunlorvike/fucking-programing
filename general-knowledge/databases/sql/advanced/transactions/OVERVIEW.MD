## **üöÄ "GI·∫¢I M√É" TRANSACTIONS TRONG SQL SERVER: "B·∫¢O HI·ªÇM" D·ªÆ LI·ªÜU CHO D√ÇN CODE üöÄ**

Yo c√°c b·∫°n sinh vi√™n IT! H√¥m nay ch√∫ng ta s·∫Ω c√πng nhau "kh√°m ph√°" m·ªôt kh√°i ni·ªám c·ª±c k·ª≥ quan tr·ªçng trong SQL Server:
Transactions (Giao d·ªãch). ƒê√¢y l√† "v≈© kh√≠" gi√∫p b·∫°n ƒë·∫£m b·∫£o t√≠nh to√†n v·∫πn v√† nh·∫•t qu√°n c·ªßa d·ªØ li·ªáu, ƒë·∫∑c bi·ªát khi th·ª±c
hi·ªán nhi·ªÅu thao t√°c c√πng l√∫c. C√πng m√¨nh "m·ªï x·∫ª" n√≥ nh√©!

### **I. TRANSACTION L√Ä G√å? (NH∆Ø "H·ª¢P ƒê·ªíNG" CHO DATABASE)**

- **Transaction (Giao d·ªãch):** L√† m·ªôt chu·ªói c√°c thao t√°c (query SQL) ƒë∆∞·ª£c th·ª±c hi·ªán nh∆∞ m·ªôt _ƒë∆°n v·ªã c√¥ng vi·ªác_.
- **N√≥ ho·∫°t ƒë·ªông nh∆∞ th·∫ø n√†o?**
    - Gi·ªëng nh∆∞ khi b·∫°n k√Ω h·ª£p ƒë·ªìng: ho·∫∑c l√† t·∫•t c·∫£ c√°c ƒëi·ªÅu kho·∫£n ƒë·ªÅu ƒë∆∞·ª£c th·ª±c hi·ªán, ho·∫∑c l√† kh√¥ng c√≥ g√¨ x·∫£y ra (n·∫øu
      c√≥ m·ªôt ƒëi·ªÅu kho·∫£n kh√¥ng ƒë∆∞·ª£c ch·∫•p nh·∫≠n).
- **Quan tr·ªçng v√¨:**
    - **T√≠nh to√†n v·∫πn:** ƒê·∫£m b·∫£o d·ªØ li·ªáu lu√¥n ƒë√∫ng, kh√¥ng b·ªã "n·ª≠a v·ªùi".
    - **Nh·∫•t qu√°n:** ƒê·∫£m b·∫£o d·ªØ li·ªáu ƒë·ªìng b·ªô, kh√¥ng b·ªã xung ƒë·ªôt.
    - **Kh√¥i ph·ª•c l·ªói:** N·∫øu c√≥ l·ªói, c√≥ th·ªÉ quay l·∫°i tr·∫°ng th√°i ban ƒë·∫ßu.

### **II. C√ÅC THU·ªòC T√çNH ACID C·ª¶A TRANSACTION (NH∆Ø "NGUY√äN T·∫ÆC V√ÄNG")**

- **ACID:** L√† 4 thu·ªôc t√≠nh quan tr·ªçng c·ªßa transaction:
    1. **Atomicity (Nguy√™n t·ª≠):** T·∫•t c·∫£ thao t√°c ph·∫£i th√†nh c√¥ng, ho·∫∑c kh√¥ng c√≥ g√¨ x·∫£y ra.
    2. **Consistency (Nh·∫•t qu√°n):** D·ªØ li·ªáu ph·∫£i lu√¥n h·ª£p l·ªá (tu√¢n th·ªß c√°c quy t·∫Øc).
    3. **Isolation (ƒê·ªôc l·∫≠p):** C√°c transaction kh√¥ng ƒë∆∞·ª£c ·∫£nh h∆∞·ªüng l·∫´n nhau (c√¥ l·∫≠p).
    4. **Durability (B·ªÅn v·ªØng):** D·ªØ li·ªáu ƒë√£ commit s·∫Ω ƒë∆∞·ª£c l∆∞u vƒ©nh vi·ªÖn (k·ªÉ c·∫£ khi c√≥ s·ª± c·ªë).

### **III. C√ö PH√ÅP C∆† B·∫¢N (C√ÅCH D√ôNG TRANSACTION)**

1. **B·∫Øt ƒë·∫ßu giao d·ªãch (Start Transaction):**

```sql
BEGIN TRANSACTION;
```

2. **Th·ª±c hi·ªán c√°c c√¢u l·ªánh SQL:**

```sql
INSERT INTO Table1 ...;
UPDATE Table2 ...;
DELETE FROM Table3 ...;
```

3. **K·∫øt th√∫c giao d·ªãch (Commit/Rollback):**

    - **`COMMIT TRANSACTION:`** Ho√†n t·∫•t (ch·∫•p nh·∫≠n) giao d·ªãch n·∫øu th√†nh c√¥ng.
    - **`ROLLBACK TRANSACTION:`** H·ªßy b·ªè giao d·ªãch (quay l·∫°i tr·∫°ng th√°i tr∆∞·ªõc khi giao d·ªãch b·∫Øt ƒë·∫ßu) n·∫øu c√≥ l·ªói.

### **IV. V√ç D·ª§ MINH H·ªåA (XEM "TH·ª∞C H√ÄNH")**

1. **Thao t√°c th√†nh c√¥ng (COMMIT):**

```sql
BEGIN TRANSACTION;

INSERT INTO Orders (OrderID, CustomerID)
VALUES (100, 1);

UPDATE Products
SET Stock = Stock - 2
WHERE ProductID = 5;

COMMIT TRANSACTION;
```

- **Gi·∫£i th√≠ch:**
    - B·∫Øt ƒë·∫ßu transaction.
    - Th√™m ƒë∆°n h√†ng m·ªõi v√†o b·∫£ng `Orders`.
    - Gi·∫£m s·ªë l∆∞·ª£ng s·∫£n ph·∫©m trong b·∫£ng `Products`.
    - K·∫øt th√∫c transaction (commit) n·∫øu kh√¥ng c√≥ l·ªói.

2. **Thao t√°c th·∫•t b·∫°i (ROLLBACK):**

```sql
BEGIN TRANSACTION;

INSERT INTO Orders (OrderID, CustomerID)
VALUES (101, 2);

UPDATE Products
SET Stock = Stock - 10
WHERE ProductID = 10;
-- Gi·∫£ s·ª≠ c√≥ l·ªói x·∫£y ra ·ªü ƒë√¢y (v√≠ d·ª•: kh√¥ng ƒë·ªß s·ªë l∆∞·ª£ng s·∫£n ph·∫©m)

ROLLBACK TRANSACTION;
```

- **Gi·∫£i th√≠ch:**
    - B·∫Øt ƒë·∫ßu transaction.
    - Th√™m ƒë∆°n h√†ng m·ªõi.
    - C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng s·∫£n ph·∫©m (gi·∫£ s·ª≠ c√≥ l·ªói x·∫£y ra).
    - H·ªßy b·ªè transaction (rollback) v√¨ c√≥ l·ªói.

### **V. M·ªòT S·ªê L∆ØU √ù QUAN TR·ªåNG (ƒê·ªÇ KH√îNG B·ªä "SAI S√ìT")**

- **D√πng `BEGIN TRANSACTION`:** Lu√¥n b·∫Øt ƒë·∫ßu transaction tr∆∞·ªõc khi th·ª±c hi·ªán c√°c thao t√°c.
- **`COMMIT` ho·∫∑c `ROLLBACK`:** Lu√¥n k·∫øt th√∫c transaction b·∫±ng `COMMIT` (th√†nh c√¥ng) ho·∫∑c `ROLLBACK` (th·∫•t b·∫°i).
- **X·ª≠ l√Ω l·ªói:** N·∫øu c√≥ l·ªói x·∫£y ra, d√πng `ROLLBACK` ƒë·ªÉ kh√¥i ph·ª•c d·ªØ li·ªáu.
- **T·ªëi ∆∞u:** N√™n d√πng transaction khi c√≥ nhi·ªÅu query li√™n quan ƒë·∫øn nhau, ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh to√†n v·∫πn.

### **VI. C√ÅC M·ª®C ƒê·ªò C√î L·∫¨P (TRANSACTION ISOLATION LEVELS) - (KI·ªÇM SO√ÅT ƒê·ªò "CH·∫∂T CH·∫º")**

- **Read Uncommitted:** Cho ph√©p ƒë·ªçc c√°c thay ƒë·ªïi ch∆∞a commit (c√≥ th·ªÉ ƒë·ªçc d·ªØ li·ªáu ch∆∞a ch√≠nh x√°c).
- **Read Committed:** Kh√¥ng cho ph√©p ƒë·ªçc c√°c thay ƒë·ªïi ch∆∞a commit (ch·ªâ ƒë·ªçc d·ªØ li·ªáu ƒë√£ commit).
- **Repeatable Read:** Kh√¥ng cho ph√©p ƒë·ªçc d·ªØ li·ªáu b·ªã thay ƒë·ªïi trong transaction kh√°c (tr√°nh ƒë·ªçc d·ªØ li·ªáu kh√¥ng nh·∫•t
  qu√°n).
- **Serializable:** M·ª©c ƒë·ªô c√¥ l·∫≠p cao nh·∫•t, ƒë·∫£m b·∫£o d·ªØ li·ªáu ho√†n to√†n nh·∫•t qu√°n (c√≥ th·ªÉ ·∫£nh h∆∞·ªüng ƒë·∫øn hi·ªáu su·∫•t).
- **C√°ch ch·ªçn m·ª©c c√¥ l·∫≠p:**
    - **`Read Uncommitted`:** √çt d√πng, tr·ª´ khi kh√¥ng quan tr·ªçng ƒë·ªô ch√≠nh x√°c.
    - **`Read Committed`:** Ph·ªï bi·∫øn, c√¢n b·∫±ng gi·ªØa hi·ªáu su·∫•t v√† ƒë·ªô ch√≠nh x√°c.
    - **`Repeatable Read`:** Cho c√°c ·ª©ng d·ª•ng c·∫ßn ƒë·ªô ch√≠nh x√°c cao, c√≥ th·ªÉ d√πng khi c√≥ nhi·ªÅu transaction ƒë·ªçc d·ªØ li·ªáu
      c√πng l√∫c.
    - **`Serializable`:** Cho ·ª©ng d·ª•ng quan tr·ªçng, ƒë·ªô ch√≠nh x√°c l√† ∆∞u ti√™n h√†ng ƒë·∫ßu, nh∆∞ng c√≥ th·ªÉ ch·∫≠m.

#### **C√∫ ph√°p:**

```sql
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED; -- m·ª©c c√¥ l·∫≠p Read Uncommitted

SET TRANSACTION ISOLATION LEVEL READ COMMITTED; -- m·ª©c c√¥ l·∫≠p Read Committed
```

### **VII. K·∫æT LU·∫¨N (T·ªîNG K·∫æT)**

Transaction l√† m·ªôt c√¥ng c·ª• r·∫•t quan tr·ªçng ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh to√†n v·∫πn v√† nh·∫•t qu√°n c·ªßa d·ªØ li·ªáu trong c∆° s·ªü d·ªØ li·ªáu. Hy v·ªçng
qua b√†i vi·∫øt n√†y, c√°c b·∫°n ƒë√£ hi·ªÉu r√µ h∆°n v·ªÅ n√≥ v√† c√≥ th·ªÉ √°p d·ª•ng v√†o c√¥ng vi·ªác h√†ng ng√†y. Ch√∫c c√°c b·∫°n code th√†nh c√¥ng!
üòé
